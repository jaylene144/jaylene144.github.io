<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@alex.xx HasJoinedTheChat</title>
    <!--
    IMAGE PLACEHOLDERS - Add these images to your /images/ folder:
    - boopy-character.png (Boopy the bot mascot)
    - alex-profile.png (Alex's profile picture)
    - player-avatar.png (Player's default avatar)
    - ending-visual.png (Optional: ending scene visuals)
    -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            overflow: hidden;
            background: #000;
        }

        #rotate-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #1a1a1a;
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #0f0;
            text-align: center;
            padding: 20px;
        }

        #rotate-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: rotate 2s infinite ease-in-out;
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }

        #game-container {
            width: 960px;
            height: 540px;
            position: absolute;
            top: 0;
            left: 0;
            background: #1a1a1a;
            overflow: hidden;
            border: 2px solid #333;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .screen.active {
            display: flex;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .glitch {
            animation: glitch 0.3s infinite;
        }

        .glitch-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 0, 0, 0.03) 0px,
                rgba(0, 255, 0, 0.03) 2px,
                rgba(0, 0, 255, 0.03) 4px
            );
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .glitch-overlay.active {
            opacity: 1;
        }

        .audio-control {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 5000;
            background: #2d2d2d;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #0f0;
            display: flex;
            gap: 10px;
        }

        .audio-btn {
            background: #444;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            transition: all 0.3s;
        }

        .audio-btn:hover {
            background: #0f0;
            color: #000;
        }

        .audio-btn.muted {
            background: #f00;
            border-color: #f00;
            color: #fff;
        }

        #intro-screen {
    position: relative; /* Allows the image to be positioned absolutely inside */
    overflow: hidden;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #0f0;
    text-align: center;
    padding: 45px;
    /* Remove the old background gradient here */
}

.background-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensures the image fills the screen without stretching */
    z-index: 1; /* Puts the image at the back */
    filter: brightness(40%); /* Makes the image darker so text is readable */
}

/* Ensure text elements appear above the image */
/* INCREASED INTENSITY SHAKING */
@keyframes intense-glitch {
    0%, 25%, 100% { transform: translate(0); text-shadow: none; color: #0f0; }
    
    /* Violent shake begins */
    2% { transform: translate(-8px, 5px); text-shadow: 5px 0 #ff00c1, -5px 0 #00fff9; color: #fff; }
    
    /* Scammer text visible area - very shaky */
    4% { transform: translate(10px, -5px); text-shadow: -6px 0 #ff00c1, 6px 0 #00fff9; color: transparent; }
    8% { transform: translate(-10px, 8px); text-shadow: 8px 0 #ff0000, -8px 0 #0000ff; color: transparent; }
    12% { transform: translate(12px, -2px); text-shadow: -4px 0 #ff0000, 4px 0 #0000ff; color: transparent; }
    
    /* Snap back attempt */
    16% { transform: translate(-6px, -6px); text-shadow: 6px 0 #fff; color: #fff; }
    20% { transform: translate(6px, 4px); color: #fff; }
}

/* SCAMMER TEXT OVERLAY */
@keyframes text-swap {
    /* Stays visible from 4% to 15% of the loop */
    0%, 3.9%, 15.1%, 100% { opacity: 0; }
    4%, 15% { 
        opacity: 1; 
        content: "scammer HasJoinedTheChat"; 
        color: #f00; 
        /* The overlay needs to shake exactly like the main text */
        animation: intense-glitch 3s infinite;
    }
}
.title-glitch, .subtitle, .btn {
    position: relative;
    z-index: 10;
}
        

     .title-glitch {
    font-size: 42px; /* Slightly larger makes the shake look more dramatic */
    margin-bottom: 20px;
    font-weight: bold;
    position: relative;
    display: inline-block;
    animation: intense-glitch 2.0s infinite; 
}

.title-glitch::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    animation: text-swap 2.0s infinite;
}

.btn {
    /* Keep your existing button styles, just ensure this line is there: */
    animation: intense-glitch 2.0s infinite;
}

        .subtitle {
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            animation: none !important; 
        }
        #start-btn {
    animation: intense-glitch 2.0s infinite !important;
    position: relative;
    z-index: 10;
}

/* 3. The profile button (and others) are explicitly told to stay still */
#profile-btn, .quiz-btn, .choice-btn-chat {
    animation: none !important;
}

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* Profile Setup Screen */
        #profile-screen {
            background: #1a1a1a;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .profile-setup {
            background: #2d2d2d;
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #0f0;
            max-width: 500px;
            text-align: center;
        }

        .profile-setup h2 {
            color: #0f0;
            margin-bottom: 30px;
            font-size: 28px;
        }

        #video-preview {
            width: 300px;
            height: 225px;
            background: #000;
            border: 3px solid #0f0;
            border-radius: 10px;
            margin: 20px auto;
            display: none;
        }

        .profile-placeholder {
            width: 150px;
            height: 150px;
            background: #444;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border: 3px solid #0f0;
        }

        #username-input {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            background: #1a1a1a;
            border: 2px solid #0f0;
            border-radius: 8px;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 16px;
        }

        #username-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        #education-screen {
            background: #1a1a1a;
            flex-direction: column;
            padding: 40px;
            overflow-y: auto;
        }

        .chatroom-header {
            background: #2d2d2d;
            padding: 15px 20px;
            border-bottom: 2px solid #0f0;
            color: #0f0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .header-profile:hover {
            opacity: 0.8;
        }

        .header-profile-pic {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid #0f0;
    object-fit: cover; /* Keeps image proportions correct */
    background: #1a1a1a;
    cursor: pointer;
}
        /* Profile Modal */
        .profile-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .profile-modal.show {
            display: flex;
        }

        .profile-content {
            background: #2d2d2d;
            border: 3px solid #0f0;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .profile-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #0f0;
            font-size: 30px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }

        .profile-large-pic {
    width: 120px;
    height: 120px;
    display: block;
    margin: 0 auto 15px;
    border-radius: 50%;
    border: 2px solid #0f0;
    object-fit: cover;
}

        .profile-username {
            color: #0f0;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .profile-bio {
            color: #fff;
            font-size: 14px;
            line-height: 1.8;
            margin-bottom: 20px;
            white-space: pre-line;
        }

        .profile-posts {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .profile-post {
    width: 80px;
    height: 80px;
    background: #1a1a1a;
    border: 2px solid #0f0; /* Green neon border to match your theme */
    border-radius: 8px;
    overflow: hidden; /* This is important: it keeps the image inside the rounded corners */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Style the image inside the box */
.profile-post img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* This crops the image to fill the square perfectly without squishing it */
}

        .system-message {
            background: #2d2d2d;
            color: #0f0;
            padding: 15px 20px;
            margin: 10px 0;
            border-left: 3px solid #0f0;
            font-size: 14px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .edu-card {
            background: #2d2d2d;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid #444;
            color: #fff;
            animation: slideIn 0.5s ease;
            display: flex;
            gap: 20px;
            align-items: center;
            position: relative;
        }

        /* Styling for Boopy in the Education Cards */
        /* This makes Boopy look natural inside the education container */
/* Styling for the larger Boopy without an aura */
.boopy-edu-standalone {
    flex-shrink: 0; /* Prevents Boopy from getting squished */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
}

.boopy-edu-standalone img {
    width: 140px; /* Increased from 100px to make him bigger */
    height: auto;
    filter: none !important; /* This explicitly removes the green glow/aura */
    object-fit: contain;
}
.boopy-intro-hero {
    text-align: center;
    padding: 30px 10px;
    margin-bottom: 20px;
}

.boopy-intro-hero img {
    width: 220px; /* Big Boopy size */
    height: auto;
    filter: none !important;
    margin-bottom: 15px;
}

.boopy-intro-hero h2 {
    color: #0f0;
    font-size: 2.2rem;
    font-family: 'Courier New', monospace;
    margin: 5px 0;
}

.hero-divider {
    border: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, #0f0, transparent);
    width: 70%;
    margin: 20px auto;
    opacity: 0.3;
}
/* Ensure the card container spreads content out correctly */
.edu-card {
    display: flex;
    align-items: center; /* Centers Boopy vertically against the text */
    gap: 20px; /* Space between Boopy and the text */
    padding: 20px;
    background: rgba(45, 45, 45, 0.8); /* Darker background to pop against */
    border-radius: 12px;
    margin-bottom: 25px;
}

.edu-text {
    flex: 1; /* This tells the text to take up all REMAINING space */
}

/* Adjust the card to allow him to sit next to the text */


/* Flip the order if it's a 'right' side visual */
.edu-card.right-visual {
    flex-direction: row-reverse;
}

/* Remove the old square styles so they don't interfere */
.edu-visual, .boopy-character {
    display: none;
}

.boopy-character img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Keeps Boopy's proportions correct */
}

/* Updated visual area for education cards */
.edu-visual {
    width: 120px;
    height: 120px;
    background: #1a1a1a; /* Dark background for the square */
    border: 2px solid #0f0; /* Green neon border */
    border-radius: 8px; /* Slight rounding of the square corners */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex-shrink: 0;
}

/* This ensures Boopy fills the square properly */
.edu-visual img {
    padding: 10px; /* Gives Boopy some breathing room inside the square */
    width: 100%;
    height: 100%;
    object-fit: contain;
}

/* Hide the old circular boopy styles if they are still in your CSS */
.boopy-character {
    display: none;
}
/* This applies a clean white glow to Boopy in both the Hero and the Cards */
.boopy-intro-hero img, 
.boopy-edu-standalone img {
    /* offset-x | offset-y | blur-radius | color */
    filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.6)) !important;
    width: 220px; /* Keep your existing size */
    height: auto;
}


        /* Fallback if image not loaded */
        .boopy-character:before {
            content: 'ü§ñ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
        }

      

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .edu-card h3 {
            color: #0f0;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .edu-card p {
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .edu-card ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .edu-card li {
            padding: 5px 0;
            font-size: 13px;
        }

        .edu-card li:before {
            content: "‚úî ";
            color: #0f0;
            margin-right: 5px;
        }

        .quiz-question {
            background: #2d2d2d;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid #0f0;
            color: #fff;
        }

        .quiz-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .quiz-btn {
            flex: 1;
            padding: 12px;
            background: #444;
            color: #fff;
            border: 2px solid #666;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        .quiz-btn:hover {
            background: #0f0;
            color: #000;
            border-color: #0f0;
        }

        .quiz-btn.correct {
            background: #0f0;
            color: #000;
            border-color: #0f0;
        }

        .quiz-btn.wrong {
            background: #f00;
            color: #fff;
            border-color: #f00;
        }

.edu-popup {
    background: #1a1a1a !important; /* Solid dark box */
    border: 1px solid #444 !important;
    border-left: 5px solid #f0f !important;
    border-radius: 8px !important;
    margin-top: 10px;
    
    /* FIX: Small and contained */
    display: none; 
    width: fit-content !important; 
    max-width: 95% !important;
    padding: 8px 15px !important; /* Forces text to stay INSIDE */
    box-sizing: border-box !important;
    
    /* ALIGNMENT: Side-by-side */
    align-items: center !important;
    justify-content: flex-start !important;
    gap: 12px !important;
}

.edu-popup.show { 
    display: flex !important; 
}

/* Ensure Boopy stays a small icon size */
.edu-popup .boopy-quiz-feedback img {
    width: 40px !important;
    height: auto;
    flex-shrink: 0;
}

/* Ensure text is white and stays on one line */
.edu-popup span {
    color: #fff !important;
    font-size: 14px !important;
    white-space: normal; 
}

 /* Ensure the screen fills the game container */
 #chat-screen {
    height: 100vh;
    display: none; /* Becomes flex when active */
    flex-direction: column; 
    background: #1a1a1a;
    overflow: hidden;
}

#chat-screen.active {
    display: flex;
}
        #chat-messages {
    flex: 1; 
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

 .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }


        .message {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 15px;
            font-size: 14px;
            animation: messageAppear 0.3s ease;
            word-wrap: break-word;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #444;
            flex-shrink: 0;
            background-color: #444;
        }

        .message-avatar.stranger {
            background: url('images/alex-profile.png') center/cover;
        }

        .message-avatar.player {
            background: url('images/player-avatar.png') center/cover;
            background-color: #0f0;
        }

        .message-content {
            flex: 1;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.stranger {
            background: #2d2d2d;
            color: #fff;
            align-self: flex-start;
            border: 1px solid #444;
        }

        .message.player {
            background: #0f0;
            color: #000;
            align-self: flex-end;
            border: 1px solid #0f0;
        }

        .message.system {
            background: #3d3d3d;
            color: #f90;
            align-self: center;
            border: 1px solid #f90;
            text-align: center;
            font-style: italic;
        }

        .sender-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
            opacity: 0.8;
        }

        .fake-image-container {
            background: #000;
            border: 2px solid #f00;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }

        .fake-image {
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #f00, #000);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin: 0 auto;
            animation: distort 0.5s infinite, color-shift 3s linear infinite;
            box-shadow: 0 0 20px #f00;
        }

        @keyframes distort {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(2deg); }
            50% { transform: scale(0.95) rotate(-2deg); }
            75% { transform: scale(1.03) rotate(1deg); }
        }

        /* Screen Shake Effects */
        @keyframes shake-light {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-2px, 1px); }
            20% { transform: translate(2px, -1px); }
            30% { transform: translate(-1px, 2px); }
            40% { transform: translate(1px, -2px); }
            50% { transform: translate(-2px, 1px); }
            60% { transform: translate(2px, 1px); }
            70% { transform: translate(-1px, -1px); }
            80% { transform: translate(1px, 2px); }
            90% { transform: translate(-2px, -1px); }
        }

        @keyframes shake-intense {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-5px, 3px) rotate(-1deg); }
            20% { transform: translate(5px, -3px) rotate(1deg); }
            30% { transform: translate(-3px, 5px) rotate(-0.5deg); }
            40% { transform: translate(3px, -5px) rotate(0.5deg); }
            50% { transform: translate(-5px, 3px) rotate(-1deg); }
            60% { transform: translate(5px, 3px) rotate(1deg); }
            70% { transform: translate(-3px, -3px) rotate(-0.5deg); }
            80% { transform: translate(3px, 5px) rotate(0.5deg); }
            90% { transform: translate(-5px, -3px) rotate(-1deg); }
        }

        .screen-shake-light {
            animation: shake-light 0.5s infinite;
        }

        .screen-shake-intense {
            animation: shake-intense 0.3s infinite;
        }

        #choice-container {
    flex-shrink: 0; 
    padding: 20px;
    background: #2d2d2d;
    border-top: 1px solid #444;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

        .choice-btn-chat {
            padding: 12px 20px;
            background: #444;
            color: #fff;
            border: 2px solid #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .choice-btn-chat:hover {
            background: #0f0;
            color: #000;
            border-color: #0f0;
            transform: translateX(5px);
        }

        .choice-btn-chat.danger:hover {
            background: #f00;
            border-color: #f00;
        }
       #horror-screen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: #000;
    z-index: 9999;
    overflow: hidden;
     justify-content: center;
    align-items: center;
}

#horror-bg-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover; /* Keeps image proportions without stretching */
    z-index: 1; /* Lowest layer */
    opacity: 0.6; /* Makes it dark so text is readable */
    filter: grayscale(1) contrast(1.5); /* Optional: Makes it look creepier */
}
        #horror-screen .message {
            animation: glitch 0.5s infinite, messageAppear 0.3s ease;
        }

        .falling-messages {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 10;
        }

        .falling-text {
            position: absolute;
            color: #f00;
            font-size: 20px;
            font-weight: bold;
            animation: fall 3s linear infinite;
            opacity: 0.7;
        }

        @keyframes fall {
            from { top: -50px; }
            to { top: 100%; }
        }

        @keyframes color-shift {
            0% { filter: hue-rotate(0deg); }
            25% { filter: hue-rotate(90deg); }
            50% { filter: hue-rotate(180deg); }
            75% { filter: hue-rotate(270deg); }
            100% { filter: hue-rotate(360deg); }
        }


        #minigame-screen {
            background: #1a1a1a;
            flex-direction: column;
        }

        .minigame-container {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .drag-task {
            margin-bottom: 30px;
        }

        .drag-task h3 {
            color: #0f0;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .drag-task p {
            color: #ccc;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .drag-items {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .drag-item {
            background: #2d2d2d;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #444;
            cursor: move;
            font-size: 12px;
            color: #fff;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            align-items: center;
            text-align: center;
            justify-content: center;
        }

        .drag-item:hover {
            border-color: #0f0;
            transform: scale(1.02);
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        .drop-zones {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .drop-zone {
            background: #2d2d2d;
            border: 2px dashed #666;
            border-radius: 10px;
            padding: 15px;
            min-height: 200px;
        }

        .drop-zone h4 {
            color: #0f0;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: center;
        }

        .drop-zone.over {
            border-color: #0f0;
            background: #3d3d3d;
        }

        .dropped-item {
            background: #444;
            padding: 6px 8px;
            margin: 4px 0;
            border-radius: 5px;
            font-size: 11px;
            color: #fff;
            border-left: 3px solid #0f0;
            line-height: 1.3;
        }

        .spot-fake-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .screenshot {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #444;
            cursor: pointer;
            transition: all 0.3s;
        }

        .screenshot:hover {
            border-color: #0f0;
            transform: scale(1.02);
        }

        .screenshot-header {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 11px;
            color: #888;
        }

        .screenshot-message {
            background: #3d3d3d;
            padding: 10px;
            border-radius: 8px;
            color: #fff;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .screenshot.correct {
            border-color: #0f0;
            background: #1a3d1a;
        }

        .screenshot.wrong {
            border-color: #f00;
            background: #3d1a1a;
        }

        #results-screen {
            background: #1a1a1a;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: #fff;
            text-align: center;
            overflow-y: auto;
        }

        .results-title {
            font-size: 36px;
            color: #0f0;
            margin-bottom: 20px;
        }

        .visual-placeholder {
            width: 120px;
            height: 120px;
            background: url('images/ending-visual.png') center/contain no-repeat;
            background-color: #2d2d2d;
            border: 3px solid #0f0;
            border-radius: 15px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
        }

        .boopy-message {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #0f0;
            margin: 20px 0;
            max-width: 700px;
            position: relative;
            padding-left: 100px;
        }

        .boopy-message:before {
            content: '';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 70px;
            height: 70px;
            background: url('images/boopy-character.png') center/contain no-repeat;
            background-color: #2d2d2d;
            border: 3px solid #0f0;
            border-radius: 50%;
        }

        /* Fallback emoji if image not loaded */
        .boopy-message:after {
            content: 'ü§ñ';
            position: absolute;
            left: 28px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 40px;
            z-index: 1;
        }

        .boopy-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .results-message {
            font-size: 16px;
            max-width: 600px;
            line-height: 1.8;
            margin-bottom: 30px;
            color: #ccc;
        }

        .safety-tips {
            background: #2d2d2d;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #0f0;
            max-width: 700px;
            text-align: left;
            margin-bottom: 30px;
        }

        .safety-tips h3 {
            color: #0f0;
            margin-bottom: 15px;
        }

        .safety-tips ul {
            list-style: none;
            padding: 0;
        }

        .safety-tips li {
            padding: 8px 0;
            border-bottom: 1px solid #444;
            font-size: 14px;
            color: #fff;
        }

        .safety-tips li:before {
            content: "‚úì ";
            color: #0f0;
            font-weight: bold;
            margin-right: 8px;
        }

        @media (orientation: portrait) {
            #rotate-message {
                display: flex !important;
            }
            #game-container {
                display: none !important;
            }
        }
        .chat-main-layout { 
    display: flex; 
    gap: 0; 
    height: 80vh; 
    background: #000;
    border-top: 1px solid #333;
}

/* Sidebar for Videos - Stacked on the left */
.camera-sidebar { 
    width: 280px; 
    display: flex; 
    flex-direction: column; 
    background: #111;
    border-right: 1px solid #333;
}

.video-container { 
    width: 100%;
    height: 210px; 
    background: #000; 
    border-bottom: 1px solid #333;
    position: relative; 
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

#webcam-live, #stranger-video-male {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

#webcam-live, #stranger-video-female {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Small labels for the cams */
.cam-label {
    position: absolute;
    top: 5px;
    left: 5px;
    font-size: 10px;
    color: #0f0;
    z-index: 10;
    background: rgba(0,0,0,0.5);
    padding: 2px 5px;
}

/* Chat Area - Right side */
.chat-interface { 
    flex-grow: 1; 
    display: flex; 
    flex-direction: column; 
    background: #000; 
}

#chatroom-log { 
    flex: 1; /* This makes the chat window fill the space */
    overflow-y: auto; 
    padding: 20px;
}

/* Choice Buttons Area */
#chatroom-choices {
    padding: 20px;
    background: #111;
    border-top: 1px solid #333;
    display: none; /* Logic will turn this to 'flex' */
    justify-content: center;
    gap: 15px;
}

.choice-btn {
    background: #0f0;
    color: #000;
    border: none;
    padding: 12px 24px;
    font-family: 'Courier New', monospace;
    font-weight: bold;
    cursor: pointer;
    text-transform: uppercase;
    transition: 0.2s;
}

.choice-btn:hover {
    background: #fff;
    transform: scale(1.05);
}
.notification-popup {
    position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
    width: 300px; background: #fff; color: #000; padding: 10px;
    border-radius: 10px; display: flex; align-items: center; gap: 10px;
    transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer; z-index: 9999; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.notification-popup.show { top: 20px; }
.notif-icon { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); 
             color: white; width: 35px; height: 35px; border-radius: 8px; 
             display: flex; align-items: center; justify-content: center; font-weight: bold; }

             /* --- CHATROOM CHOICES NEON STYLE --- */
        #chatroom-controls {
            background: #111;
            border-top: 1px solid #333;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        #chatroom-choices {
            display: none; /* JS toggles this to 'flex' */
            gap: 15px;
            padding: 20px;
            justify-content: center;
            width: 100%;
        }

        .choice-btn {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 15px 25px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s ease;
            box-shadow: 0 0 5px #0f0;
        }

        .choice-btn:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 20px #0f0;
            transform: translateY(-2px);
        }
.spot-fake-container {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    width: 100%;
}

.photo-box {
    background: #111;
    border: 2px solid #444;
    border-radius: 8px;
    height: 260px; /* Adjust based on your screen size */
    overflow: hidden;
    cursor: pointer;
    transition: all 0.2s;
}

.task-img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* This makes the image fill the box properly */
    display: block;
}

/* These match the classes your checkScreenshot function adds */
.screenshot.correct {
    border-color: #f00 !important;
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
}

.screenshot.wrong {
    border-color: #0f0 !important;
    opacity: 0.5;
}
.minigame-container h3 {
    color: white !important;
}

@keyframes intense-shake {
    0% { transform: translate(0,0); }
    25% { transform: translate(5px, 5px); color: #ff0000; }
    50% { transform: translate(-5px, -5px); color: #00ffff; }
    75% { transform: translate(5px, -5px); }
    100% { transform: translate(0,0); }
}

.glitch-active {
    animation: intense-shake 0.1s infinite;
}
/* Extreme color ghosting effect */
.extreme-glitch {
    text-shadow: 2px 0 #ff0000, -2px 0 #00ffff !important;
    animation: jitter 0.1s infinite;
}

@keyframes jitter {
    0% { transform: translate(0,0); }
    33% { transform: translate(2px, -2px); }
    66% { transform: translate(-2px, 2px); }
    100% { transform: translate(0,0); }
}

/* Make text look corrupted */
.corrupted-text {
    font-family: 'Wingdings', 'Arial Black', sans-serif !important;
    letter-spacing: 5px;
    color: #ff0000 !important;
}
.results-boopy-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px 0;
}

.results-boopy-img {
    width: 170px; /* Adjust size as needed */
    height: auto;
    filter: drop-shadow(0 0 10px rgb(255, 255, 255)); /* Gives Boopy a nice green glow for the win */
    animation: celebrate 2s ease-in-out infinite;
}

/* Optional: Make Boopy bounce slightly to celebrate */
@keyframes celebrate {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

    </style>
</head>
<body>
    <div class="boopy-hi">
    <img id="boopy-hi" src="boopy hi.png" alt="Boopy" style="width: 100%; height: auto;">
</div>
<div class="boopy-correct">
    <img id="boopy-correct" src="boopy-correct.png" alt="Boopy" style="width: 100%; height: auto;">
</div>
    <div class="audio-control">
        <button class="audio-btn" id="toggle-music" onclick="toggleMusic()">üéµ Music</button>
        <button class="audio-btn" id="toggle-sfx" onclick="toggleSFX()">üîä SFX</button>
    </div>

    <audio id="bg-music-intro" loop><source src="introo music.MP3" type="audio/mpeg"></audio>
    <audio id="bg-music-education" loop><source src="introo music.MP3" type="audio/mpeg"></audio>
    <audio id="bg-music-chat" loop><source src="introo music.MP3" type="audio/mpeg"></audio>
    <audio id="bg-music-horror" loop><source src="horrror.mp3" type="audio/mpeg"></audio>
    <audio id="bg-music-calm" loop><source src="intro music.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-message" preload="auto"><source src="audio/message-sound.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-glitch" preload="auto"><source src="Glitch Sound Effect.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-click" preload="auto"><source src="audio/click-sound.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-correct" preload="auto"><source src="CORRECT ANSWER SOUND EFFECT  NO COPYRIGHT.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-wrong" preload="auto"><source src="Wrong Buzzer - Sound Effect.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-warning" preload="auto"><source src="audio/warning-sound.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-success" preload="auto"><source src="success - Sound Effect.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-horror" preload="auto"><source src="Jumpscare Sound Effect.mp3" type="audio/mpeg"></audio>
    <audio id="male-voice" preload="auto"><source src="male voice.mp3" type="audio/mpeg"></audio>
    <audio id="female-voice" preload="auto"><source src="female voice.mp3" type="audio/mpeg"></audio>

    <div id="rotate-message">
        <div id="rotate-icon">üì±</div>
        <h1>Please Rotate Your Screen</h1>
        <p style="font-size: 18px; margin-top: 10px;">This chatroom experience is best viewed in landscape mode</p>
    </div>

    <div id="game-container">
        <div class="glitch-overlay" id="glitch-overlay"></div>
        

        <div id="intro-screen" class="screen active">
            <div class="title-glitch" data-text="@alex.xx HasJoinedTheChat">@alex.xx HasJoinedTheChat</div>
            <img src="title bg.png" class="background-img" alt="Horror Background">
        <button class="btn" id="start-btn" onclick="startGame()">Enter Chatroom</button>
        </div>

       <div id="profile-screen" class="screen">
    <div class="profile-setup">
        <h2>üü¢ Setup Your Profile</h2>
        <div class="profile-placeholder" id="profile-icon">üë§</div>

        <video id="video-preview" autoplay playsinline style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover; display: none; margin: 10px auto; border: 3px solid #0f0;"></video>
        <canvas id="canvas" width="400" height="400" style="display: none;"></canvas>

        <div style="margin: 10px 0;">
            <button class="audio-btn" id="start-camera" onclick="startCamera()">Enable Camera</button>
            <button class="audio-btn" id="take-photo" onclick="takePhoto()" style="display: none;">Snap Photo</button>
        </div>

        <p style="color: #ccc; margin: 20px 0;">Enter your username:</p>
        <input type="text" id="username-input" placeholder="Enter username..." maxlength="20">
        
        <button class="btn" id="profile-btn" onclick="completeProfile()" style="margin-top: 20px; width: 100%;">Continue</button>
    </div>
</div>
        <div id="education-screen" class="screen">
            <div class="chatroom-header">
                <span>üü¢ ONLINE SAFETY DEMO</span>
                <span id="edu-progress">Learning...</span>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 20px;" id="education-content"></div>
        </div>
        
<div id="the-chatroom-screen" class="screen" style="display: none; height: 100vh; width: 100vw; background: #000; position: fixed; top: 0; left: 0; z-index: 1000;">
    <div style="display: flex; height: 100%; width: 100%;">
        
        <div style="width: 260px; border-right: 1px solid #333; background: #111; display: flex; flex-direction: column; flex-shrink: 0;">
            <div style="height: 200px; border-bottom: 1px solid #333; background: #000; position: relative;">
                <video id="webcam-live" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
            </div>
            <div style="height: 200px; background: #000; position: relative; display: flex; align-items: center; justify-content: center;">
                <div id="stranger-video-placeholder" style="color: #444; font-size: 12px; font-weight: bold;">CAMERA OFF</div>
                
                <video id="stranger-video-male" class="stranger-vid" loop muted playsinline preload="auto" style="display: none; width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;">
        <source src="male chatroom video.mp4" type="video/mp4">
    </video>

                <video id="stranger-video-female" class="stranger-vid" loop muted playsinline style="display: none; "></video>
                    <source src="female chatroom video.mp4" type="video/mp4">
                </video>
            </div>
        </div>

        <div style="flex: 1; display: flex; flex-direction: column; background: #000; position: relative;">
            <div id="chatroom-log" style="flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 140px; box-sizing: border-box; background: #000;">
                </div>

            <div id="chatroom-controls" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 130px; background: #0a0a0a; border-top: 2px solid #0f0; display: none; align-items: center; justify-content: center; z-index: 9999;">
                <div id="chatroom-choices" style="display: flex; gap: 15px; width: 100%; justify-content: center; padding: 10px;">
                    </div>
            </div>
        </div>
    </div>
</div>
  
<div id="fakestagram-notification" class="notification-popup">
    <div class="notif-icon">F</div>
    <div class="notif-content">
        <div class="notif-title">Fakestagram</div>
        <div class="notif-text"><strong>alex.xx</strong>: Found ya lol lol</div>
    </div>
</div>

<div id="chat-screen" class="screen">
            <div class="chatroom-header">
                <div class="header-profile" onclick="showProfile()"> 
    <img class="header-profile-pic" id="alex-header-pic" src="alex pfp.png" alt="Alex"> 
    <span id="chat-header-text">alex.xx</span> 
</div>
                <span id="scene-indicator" style="display: none;">Scene 1/7</span>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages"></div>
                <div class="choice-container" id="choice-container"></div>
            </div>
            
        
            <!-- Profile Modal -->
            <div class="profile-modal" id="profile-modal" onclick="closeProfile()">
                <div class="profile-content" onclick="event.stopPropagation()">
                    <button class="profile-close" onclick="closeProfile()">√ó</button>
                     <img class="profile-large-pic" id="alex-large-pic" src="alex pfp.png" alt="Alex">
                    <div class="profile-username">alex.xx</div>
                    <div class="profile-bio">NP Banking & finance
gym / school / repeat
Always down for mala heh</div>
                    <div class="profile-posts">
    <div class="profile-post"><img src="post 1.png" alt="Post 1"></div>
    <div class="profile-post"><img src="post 2.png" alt="Post 2"></div>
    <div class="profile-post"><img src="post 3.png" alt="Post 3"></div>
</div>
                </div>
            </div>
        </div>
<div id="horror-screen" class="screen">
    <img src="horror screen bg.png" id="horror-bg-image" alt="Horror Background">
    <div class="falling-messages" id="falling-messages" style="z-index: 5;"></div>
    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; position: relative; z-index: 10;">
        <h2 style="color: #f00; font-size: 32px; text-align: center; margin: 20px; text-shadow: 0 0 10px #000;">IDENTITY COMPROMISED</h2>
        <p style="color: #fff; text-align: center; max-width: 500px; margin-bottom: 30px; text-shadow: 0 0 5px #000;">Your digital identity is being manipulated. This is what loss of control feels like...</p>
        <button class="btn" onclick="startMinigame()" style="background: #f00; color: #fff;">ESCAPE THE CHATROOM</button>
    </div>
</div>

        <div id="minigame-screen" class="screen">
            <div class="chatroom-header">
                <span>üîê SAFETY RECOVERY PROTOCOL</span>
                <span id="minigame-progress">Task 1/2</span>
            </div>
            <div class="minigame-container" id="minigame-content"></div>
        </div>
<div id="task2-template" style="display: none;">
        <div class="spot-fake-container">
            <div class="screenshot photo-box" data-fake="false">
                <img src="real image 1.jpeg" class="task-img">
            </div>
            <div class="screenshot photo-box" data-fake="true">
                <img src="ai gen 1.png" class="task-img">
            </div>
            <div class="screenshot photo-box" data-fake="true">
                <img src="ai gen 2.png" class="task-img">
            </div>
        </div>
    </div>
</div>
        <div id="results-screen" class="screen">
            <h1 class="results-title">‚úì You've Escaped</h1>
           
            <div class="boopy-message">
                <p style="color: #0f0; font-weight: bold; margin-bottom: 10px;">Boopy says:</p>
                <p style="color: #fff;">"You almost experienced an online harm, good job on escaping!"</p>
            </div>
            <div class="results-boopy-container">
        <img src="boopy-ending.png" alt="Boopy" class="results-boopy-img">
    </div>
            <p class="results-message">
                Today, you saw how strangers online can pretend to be someone you know, use Generative AI to alter images or messages, and twist your posts or profile pictures into something harmful. These dangers are real, but they don't mean you should be afraid of being online or sharing your life.
            </p>

            <div class="safety-tips">
                <h3>Instead, remember to:</h3>
                <ul>
                    <li>Stay cautious with unexpected messages, especially from "friends" acting strangely</li>
                    <li>Protect your personal details and images the way you'd protect anything valuable</li>
                    <li>Trust your instincts when something feels off</li>
                    <li>Block, report, and seek support if anything goes wrong</li>
                    <li>Make informed choices and stay aware</li>
                </ul>
            </div>
    
            <p style="color: #0f0; font-size: 18px; margin: 20px 0;">Stay alert, stay aware, and stay safe out there.</p>
            <button class="btn" onclick="restartGame()">Play Again</button>
        </div>
    </div>
    

    <script>
        let musicEnabled = true;
        let sfxEnabled = true;
        let currentMusic = null;
        let playerUsername = "";
        let meetPreference = 'female'; // Default preference
        let playerProfilePic = "üë§";
        let currentScene = 0;
        let glitchLevel = 0;
        let currentQuizIndex = 0;
        let scene2Choice = "";
        let scene3Choice = "";

let stream = null;

async function startCamera() {
    try {
        // Request access to webcam
        stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        const video = document.getElementById('video-preview');
        const icon = document.getElementById('profile-icon');
        const startBtn = document.getElementById('start-camera');
        const snapBtn = document.getElementById('take-photo');

        video.srcObject = stream;
        video.style.display = 'block'; // Show camera
        icon.style.display = 'none';    // Hide the 'üë§' icon
        startBtn.style.display = 'none'; // Hide enable button
        snapBtn.style.display = 'inline-block'; // Show snap button
        playSFX('click');
    } catch (err) {
        alert("Camera access denied. You can still play with the default icon!");
        console.error(err);
    }
}

function takePhoto() {
    const video = document.getElementById('video-preview');
    const canvas = document.getElementById('canvas');
    const icon = document.getElementById('profile-icon');
    const context = canvas.getContext('2d');

    // Draw the current video frame onto the hidden canvas
    context.drawImage(video, 0, 0, 400, 400);
    
    // Save the image data into our global variable
    playerProfilePic = canvas.toDataURL('image/png');
    // Show the taken photo in the circle
    icon.style.backgroundImage = `url(${playerProfilePic})`;
    icon.innerHTML = "";
    icon.style.backgroundSize = 'cover';
    icon.style.textContent = '';
    icon.style.display = 'flex';
    
    // Hide video and stop camera
    video.style.display = 'none';
    if (stream) stream.getTracks().forEach(track => track.stop());
    
    document.getElementById('take-photo').textContent = "Retake Photo";
    playSFX('success');
}


        const audioFiles = {
            music: {
                intro: document.getElementById('bg-music-intro'),
                education: document.getElementById('bg-music-education'),
                chat: document.getElementById('bg-music-chat'),
                horror: document.getElementById('bg-music-horror'),
                calm: document.getElementById('bg-music-calm')
            },
            sfx: {
                message: document.getElementById('sfx-message'),
                glitch: document.getElementById('sfx-glitch'),
                click: document.getElementById('sfx-click'),
                correct: document.getElementById('sfx-correct'),
                wrong: document.getElementById('sfx-wrong'),
                warning: document.getElementById('sfx-warning'),
                success: document.getElementById('sfx-success'),
                horror: document.getElementById('sfx-horror'),
                male: document.getElementById('male-voice'),
                female: document.getElementById('female-voice'),
            }
        };

        Object.values(audioFiles.music).forEach(audio => audio.volume = 0.3);
        Object.values(audioFiles.sfx).forEach(audio => audio.volume = 0.5);
        


        function playMusic(track) {
            if (!musicEnabled) return;
            Object.values(audioFiles.music).forEach(music => {
                music.pause();
                music.currentTime = 0;
            });
            if (audioFiles.music[track]) {
                currentMusic = audioFiles.music[track];
                currentMusic.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        function playSFX(effect) {
            if (!sfxEnabled) return;
            if (audioFiles.sfx[effect]) {
                const sound = audioFiles.sfx[effect].cloneNode();
                sound.volume = 0.5;
                sound.play().catch(e => console.log('SFX play failed:', e));
            }
        }

        function toggleMusic() {
            musicEnabled = !musicEnabled;
            const btn = document.getElementById('toggle-music');
            if (musicEnabled) {
                btn.classList.remove('muted');
                btn.textContent = 'üéµ Music';
                if (currentMusic) currentMusic.play().catch(e => console.log('Audio play failed:', e));
            } else {
                btn.classList.add('muted');
                btn.textContent = 'üîá Music';
                if (currentMusic) currentMusic.pause();
            }
        }

        function toggleSFX() {
            sfxEnabled = !sfxEnabled;
            const btn = document.getElementById('toggle-sfx');
            btn.classList.toggle('muted');
            btn.textContent = sfxEnabled ? 'üîä SFX' : 'üîá SFX';
        }

        function startGame() {
            playSFX('click');
            playMusic('intro');
            switchScreen('intro-screen', 'profile-screen');
        }

       function switchScreen(fromId, toId) {
    document.getElementById(fromId).classList.remove('active');
    document.getElementById(fromId).style.display = 'none';
    
    const toScreen = document.getElementById(toId);
    toScreen.classList.add('active');
    toScreen.style.display = 'flex';
}

        function completeProfile() {
        // Update MY avatar in the chat, not Alex's
    const myAvatar = document.getElementById('my-chat-avatar');
    if (myAvatar && playerProfilePic) {
        myAvatar.style.backgroundImage = `url(${playerProfilePic})`;
        myAvatar.style.backgroundSize = 'cover';
        myAvatar.innerText = ""; // Removes the üë§ from the chat top
    }
            const username = document.getElementById('username-input').value.trim();
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            playerUsername = username;
           
            const headerPic = document.querySelector('.header-profile-pic');
    if (headerPic && playerProfilePic) {
        headerPic.style.backgroundImage = `url(${playerProfilePic})`;
        headerPic.style.backgroundSize = 'cover';
        headerPic.style.backgroundPosition = 'center';
        headerPic.textContent = ''; // Clears the default üë§ icon
    }

    
 
            playSFX('click');
            
            switchScreen('profile-screen', 'education-screen');
            startEducation();
        }

        const educationContent = [
            { type: 'system', text: 'Welcome to our Online Safety Demo. Hi! I\'m Boopy, your friendly companion bot!' },
            { type: 'system', text: 'Before you start chatting, learn about generative AI!' },
            { 
                type: 'card', 
                visual: 'ü§ñ',
                side: 'left',
                title: 'What is Generative AI?', 
                content: 'Generative AI is a type of artificial intelligence that can create new content‚Äîsuch as text, images, videos, voices, and even entire conversations‚Äîbased on patterns it has learned from large amounts of data.<br><br>Instead of just giving answers, it can generate things that look and sound real, including:<br>‚Ä¢ Messages that feel human<br>‚Ä¢ Edited or fake images<br>‚Ä¢ Voice clips that mimic someone\'s tone<br>‚Ä¢ Fake screenshots or conversations.' 
            },
            { 
                type: 'card', 
                visual: '‚ö†Ô∏è',
                side: 'right',
                title: 'How does it cause harm?', 
                items: ['Because it can imitate people so convincingly, generative AI can be misused by strangers online to create fake identities, pretend to be your friend, or manipulate images or messages to pressure, scam, or harm you', 'Fake identities', 'Incriminating AI-generated photos', 'Deepfake voice/text', 'Manipulation & coercion']
            }
        ];

        const quizQuestions = [
            { question: 'AI can copy your voice from a tiny whisper of audio...', correctAnswer: 'truth', feedback: 'AI voice-cloning tools only need a few seconds of audio to create convincing deepfakes.' },
            { question: 'No one will pretend to be you unless you\'re famous.', correctAnswer: 'false', feedback: 'Anyone can be targeted. Scammers use AI to impersonate ordinary people to manipulate their friends and family.' },
            { question: 'Anything deleted online disappears forever.', correctAnswer: 'false', feedback: 'Posts can be screenshotted, archived, or saved by others before you delete them.' },
            { question: 'AI cannot change photos of you without your permission.', correctAnswer: 'false', feedback: 'Strangers can steal your selfies and use AI tools to alter them, create fakes, or spread misinformation without your consent.' },
            { question: 'Scammers don\'t use AI ‚Äî they only message manually.', correctAnswer: 'false', feedback: 'AI helps them write convincing messages, fake emotions, and talk like someone you trust.' },
            { question: 'AI can rewrite chats to sound exactly like someone you know.', correctAnswer: 'truth', feedback: 'AI imitation tools can mimic writing style, tone, and texting patterns, making impersonation harder to spot.' }
        ];
function startEducation() {
    const content = document.getElementById('education-content');
    let delay = 0;
    let cardCount = 0;

    // --- ADDED: Show Big Boopy at the very top ---
    const heroTemplate = document.getElementById('boopy-template-hero');
    if (heroTemplate) {
        const heroClone = heroTemplate.content.cloneNode(true);
        content.appendChild(heroClone);
        delay = 1500; // Give players a moment to see him before the first card pops up
    }
    // ---------------------------------------------

    educationContent.forEach((item, index) => {
        setTimeout(() => {
            if (item.type === 'system') {
                playSFX('message');
                const msg = document.createElement('div');
                msg.className = 'system-message';
                msg.textContent = item.text;
                content.appendChild(msg);
            } else if (item.type === 'card') {
                cardCount++; 
                
                const card = document.createElement('div');
                card.className = `edu-card ${item.side}-visual`;
                
                let templateId = (cardCount === 1) ? 'boopy-template-1' : 'boopy-template-2';
                const template = document.getElementById(templateId);
                
                const boopyClone = template.content.cloneNode(true);
                
                const textDiv = document.createElement('div');
                textDiv.className = 'edu-text';
                
                let cardHTML = `<h3>${item.title}</h3>`;
                if (item.content) cardHTML += `<p>${item.content}</p>`;
                if (item.items) {
                    cardHTML += '<ul>' + item.items.map(li => `<li>${li}</li>`).join('') + '</ul>';
                }
                textDiv.innerHTML = cardHTML;

                card.appendChild(boopyClone);
                card.appendChild(textDiv);
                
                content.appendChild(card);
            }
            content.scrollTop = content.scrollHeight;
        }, delay);
        delay += 4000;
    });
    setTimeout(() => startQuiz(), delay + 4000);
}
        function showProfile() {
            playSFX('click');
            document.getElementById('profile-modal').classList.add('show');
        }

        function closeProfile() {
            playSFX('click');
            document.getElementById('profile-modal').classList.remove('show');
        }

        function startQuiz() {
            showQuizQuestion(currentQuizIndex);
        }

        function showQuizQuestion(index) {
            if (index >= quizQuestions.length) {
                playSFX('success');
                setTimeout(() => {
                    const msg = document.createElement('div');
                    msg.className = 'system-message';
                    msg.style.background = '#0f0';
                    msg.style.color = '#000';
                    msg.textContent = '‚úì Education complete! Now you may begin chatting...';
                    document.getElementById('education-content').appendChild(msg);
                }, 500);
                setTimeout(() => {
                    
                   // This diverts the player to the new middle section
                 startTheChatroom();
                }, 2500);
                return;
            }

            const content = document.getElementById('education-content');
            const q = quizQuestions[index];
            const quizDiv = document.createElement('div');
            quizDiv.className = 'quiz-question';
            quizDiv.innerHTML = `
                <p><strong>Question ${index + 1}/6:</strong> ${q.question}</p>
                <div class="quiz-options">
                    <button class="quiz-btn" onclick="answerQuiz(${index}, 'truth')">Truth</button>
                    <button class="quiz-btn" onclick="answerQuiz(${index}, 'false')">False</button>
                </div>
                <div class="edu-popup" id="popup-${index}">üí° ${q.feedback}</div>
            `;
            content.appendChild(quizDiv);
            content.scrollTop = content.scrollHeight;
        }

 function answerQuiz(index, answer) {
    const q = quizQuestions[index];
    const currentQuizDiv = document.querySelector('.quiz-question:last-child');
    const buttons = currentQuizDiv.querySelectorAll('.quiz-btn');
    const popup = document.getElementById(`popup-${index}`);
    
    // 1. Wipe the old üí° or ‚úì icon completely
    popup.innerHTML = ''; 
    popup.classList.remove('show');

    buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.textContent.toLowerCase() === q.correctAnswer) {
            btn.classList.add('correct');
        }
    });
    if (answer !== q.correctAnswer) {
                playSFX('wrong');
                buttons.forEach(btn => {
                    if (btn.textContent.toLowerCase() === answer) btn.classList.add('wrong');
                });
                popup.classList.add('show');
            } else {
                playSFX('correct');
                popup.innerHTML = '‚úì Correct!';
                popup.style.borderLeftColor = '#0f0';
                popup.classList.add('show');
            }

    const isCorrect = (answer === q.correctAnswer);
    const templateId = isCorrect ? 'boopy-template-correct' : 'boopy-template-wrong';
    const template = document.getElementById(templateId);

    // 2. Add Boopy to the box
    if (template) {
        const boopyClone = template.content.cloneNode(true);
        const wrapper = document.createElement('div');
        wrapper.className = 'boopy-quiz-feedback';
        wrapper.appendChild(boopyClone);
        popup.appendChild(wrapper);
    }

    // 3. Add Text right next to him
    const textSpan = document.createElement('span');
    textSpan.textContent = isCorrect ? "Correct!" : q.feedback;
    popup.appendChild(textSpan);

    // 4. Update colors and show
    popup.style.borderLeftColor = isCorrect ? '#0f0' : '#f00';
    popup.classList.add('show');

    setTimeout(() => {
        currentQuizIndex++;
        showQuizQuestion(currentQuizIndex);
    }, 2500);
}
        const chatScenarios = {
            scene1: {
                messages: [
                    { sender: 'stranger', text: 'Found ya lol lol' },
                    { sender: 'stranger', text: ' is this really you from the chatroom? üëÄ' }
                    
                ],
                choices: [
                    { text: 'Hey? Howd you get my fakesta handle?', next: 'scene2', choiceId: 'a' },
                    { text: 'Ohh yeah now I remember you!', next: 'scene2', choiceId: 'b' },
                    { text: 'Why are you DMing me?', next: 'scene2', choiceId: 'c' }
                ]
            },
            scene2: {
                getMessages: () => {
                    const responses = {
                        a: 'Recognised u from ur posts! I knew we had mutuals lol lol',
                        b: 'Niceee, glad i was memorable lol',
                        c: 'Just recognised u from your posts! And wanted to properly say hi lol'
                    };
                    return [
                        { sender: 'stranger', text: responses[scene2Choice] },
                        { sender: 'stranger', text: 'NGL i thought u were cool back then but i forgot to exchange contacts with u lol' }
                    ];
                },
                choices: [
                    { text: 'Oh rlly...', next: 'scene3', choiceId: 'a' },
                    { text: 'Um okay, thanks I guess', next: 'scene3', choiceId: 'b' },
                    { text: 'I dont even know who you are...', next: 'scene3', choiceId: 'c' }
                ]
            },
            scene3: {
                getMessages: () => {
                    const responses = {
                        a: 'Ur welcome ',
                        b: 'Ur welcome ',
                        c: 'I just want to make new friends!'
                    };
                    return [
                        { sender: 'stranger', text: responses[scene3Choice] },
                        { sender: 'stranger', text: 'wanna exchange tele?' }
                    ];
                },
                choices: [
                    { text: 'Hmm‚Ä¶im not too sure abt that yet‚Ä¶', next: 'mediaProof' }
                    
                ]
            },
            mediaProof: {
                getMessages: () => {
                    // Determine assets based on meetPreference (male/female)
                    const voiceMsg = meetPreference === 'male' ? 'male voice message' : 'female voice message';
                   
                    
                    return [
                        { sender: 'stranger', text: `cmon click on my profile and see if u rmbr me`, isAudio: true },
                        { sender: 'stranger', text: 'Now do you believe me?' }
                    ];
                },
                choices: [
                    { text: 'i guess...', next: 'scene4', choiceId: '1' },
                    { text: 'Not rlly...', next: 'scene4', choiceId: '2' },
                    { text: 'Yes! I remember u now lol', next: 'scene4', choiceId: '3' }
                ]
            },

                scene4: {
                getMessages: () => {
                    // Responses based on the "Now do you believe me" choices
                    const responses = {
                        '1': 'Hey cmon...',
                        '2': 'Hey cmon...',
                        '3': 'Niceee finally lol'
                    };
                    return [
                        { sender: 'stranger', text: responses[scene3Choice] || 'Hey cmon...' },
                        { sender: 'stranger', text: 'now why not u send me a pic to prove that its rlly you' }
                    ];
                },
                choices: [
                    { text: '*Send an image* üì∏', next: 'reveal', choiceId: 'send' },
                    { text: 'Sorry im not really comfortable with that...', next: 'reveal', choiceId: 'refuse' },
                    { text: 'Why do you need my photo?', next: 'reveal', choiceId: 'ask' }
                ]
            },
            reveal: {
                getMessages: () => {
                    const responses = {
                        send: ['üî•üî•üî• hottiee'],
                        refuse: [' i can also still see you through your pfp...', 'Heh, got your pictures from your posts and profile picture'],
                        ask: ['Js couldnt stop thinking about you...', 'Heh, got your pictures from your posts and profile picture']
                    };
                    const msgs = responses[scene3Choice] || responses.refuse;
                    return msgs.map(text => ({ sender: 'stranger', text }));
                },
                showFakeImage: true,
            }
        };

        function startChatScenario(sceneKey) {
            currentScene++;
            document.getElementById('scene-indicator').textContent = `Scene ${currentScene}/7`;
            const scenario = chatScenarios[sceneKey];
            const messagesContainer = document.getElementById('chat-messages');
            const choiceContainer = document.getElementById('choice-container');
            messagesContainer.innerHTML = '';
            choiceContainer.innerHTML = '';

            if (currentScene > 2) increaseGlitch();

            const messages = scenario.getMessages ? scenario.getMessages() : scenario.messages;
            let delay = 0;
            messages.forEach(msg => {
                setTimeout(() => addMessage(msg.sender, msg.text), delay);
                delay += 1500;
            });

            if (scenario.showFakeImage) {
                setTimeout(() => {
                    playSFX('warning');
                    playSFX('glitch');
                    // Start screen shake
                    document.getElementById('game-container').classList.add('screen-shake-light');
                    
                    const fakeDiv = document.createElement('div');
                    fakeDiv.className = 'fake-image-container';
                    fakeDiv.innerHTML = '<div class="fake-image">‚ö†Ô∏è</div><p style="color: #f00; margin-top: 10px;">AI-Generated Fake Image of You</p>';
                    messagesContainer.appendChild(fakeDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;

                    // DIRECT TRANSITION: Wait 1 second after image appears, then jump to horror
                    setTimeout(() => {
                        playMusic('horror');
                        playSFX('horror');
                        // Clean up shakes before switching
                        document.getElementById('game-container').classList.remove('screen-shake-light', 'screen-shake-intense');
                        switchScreen('chat-screen', 'horror-screen');
                        startHorrorScene();
                    }, 2000); 

                }, delay);
                
                return; // THIS IS KEY: It stops the rest of the function from showing buttons
            }

            if (scenario.showMultipleFakes) {
                setTimeout(() => {
                    playSFX('warning');
                    playSFX('glitch');
                    // Intensify screen shake
                    document.getElementById('game-container').classList.remove('screen-shake-light');
                    document.getElementById('game-container').classList.add('screen-shake-intense');
                    
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            playSFX('glitch');
                            const fakeDiv = document.createElement('div');
                            fakeDiv.className = 'fake-image-container';
                            fakeDiv.innerHTML = `<div class="fake-image">‚ö†Ô∏è</div><p style="color: #f00; margin-top: 10px;">Fake Image ${i + 1}</p>`;
                            messagesContainer.appendChild(fakeDiv);
                            messagesContainer.scrollTop = messagesContainer.scrollHeight;
                            
                            // Show choices after the last fake image
                            if (i === 2) {
                                setTimeout(() => {
                                    scenario.choices.forEach(choice => {
                                        const btn = document.createElement('button');
                                        btn.className = 'choice-btn-chat';
                                        btn.classList.add('choice-shake');
                                        btn.textContent = choice.text;
                                        btn.onclick = () => handleChoice(choice);
                                        choiceContainer.appendChild(btn);
                                    });
                                }, 300);
                            }
                        }, i * 800);
                    }
                }, delay);
                return; // Exit early since we've shown choices
            }

            // Show choices for normal scenarios (not fake image scenarios)
            setTimeout(() => {
                scenario.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn-chat';
                    btn.textContent = choice.text;
                    btn.onclick = () => handleChoice(choice);
                    choiceContainer.appendChild(btn);
                });
            }, delay);
        }

       function addMessage(sender, text) {
            if (sender === 'stranger') playSFX('message');
            else if (sender === 'system' && text.includes('‚ö†Ô∏è')) playSFX('warning');

            const messagesContainer = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
        
            if (sender !== 'system') {
                // Add avatar
                const avatar = document.createElement('div');
                avatar.className = `message-avatar ${sender}`;
                msgDiv.appendChild(avatar);
                
                if (sender !== 'stranger' && playerProfilePic) {
            avatar.style.backgroundImage = `url(${playerProfilePic})`;
            avatar.style.backgroundSize = 'cover';
            avatar.style.backgroundPosition = 'center';
            avatar.textContent = ''; // Clear the default üë§ icon
        }
        msgDiv.appendChild(avatar);
        
                // Message content wrapper
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const senderName = document.createElement('div');
                senderName.className = 'sender-name';
                senderName.textContent = sender === 'stranger' ? 'alex.xx' : playerUsername;
                contentDiv.appendChild(senderName);
                
                const textDiv = document.createElement('div');
                textDiv.textContent = text;
                contentDiv.appendChild(textDiv);
                
                msgDiv.appendChild(contentDiv);
            } else {
                // System messages don't have avatars
                const textDiv = document.createElement('div');
                textDiv.textContent = text;
                msgDiv.appendChild(textDiv);
            }
    
            messagesContainer.appendChild(msgDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
       // This goes inside your function that renders the scenes (e.g., startChatScenario)
function displayScene(sceneKey) {
    const scene = chatScenarios[sceneKey];
    const choiceContainer = document.getElementById('choice-container');
    
    // 1. Clear buttons immediately
    choiceContainer.innerHTML = '';

    // 2. Render messages (Existing logic)
    const msgs = scene.getMessages ? scene.getMessages() : scene.messages;
    let delay = 0;
    msgs.forEach((msg, index) => {
        delay = index * 1200; 
        setTimeout(() => {
            let type = 'text';
            if (msg.isAudio) type = 'audio';
            if (msg.isImage) type = 'image';
            addMessage(msg.sender, msg.text, type);
        }, delay);
    });

    // 3. THE FIX: AUTOMATIC HORROR TRIGGER
    if (scene.showFakeImage) {
        // Wait for the final message to appear
        setTimeout(() => {
            // Trigger your image animation
            showFakeImageEffect(); 
            
            // Force the jump to horror after 3 seconds
            setTimeout(() => {
                console.log("Automatic transition to horror screen...");
                
                // IMPORTANT: Ensure these IDs match your HTML
                switchScreen('chat-screen', 'horror-screen'); 
                
                playMusic('horror');
                playSFX('horror');
                
                // Start your falling text/video
                if (typeof startHorrorEffects === 'function') startHorrorEffects();
                
            }, 3000); 

        }, delay + 500);

        return; // This prevents buttons from appearing
    }

    // 4. Normal Button Rendering (Only if not a horror scene)
    setTimeout(() => {
        if (scene.choices && scene.choices.length > 0) {
            scene.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn-chat';
                btn.textContent = choice.text;
                btn.onclick = () => {
                    playSFX('click');
                    if (choice.choiceId) {
                        if (sceneKey === 'scene4') scene4Choice = choice.choiceId;
                    }
                    displayScene(choice.next);
                };
                choiceContainer.appendChild(btn);
            });
            // Auto-scroll to show buttons
            const chatMsgs = document.getElementById('chat-messages');
            chatMsgs.scrollTop = chatMsgs.scrollHeight;
        }
    }, delay + 1000);
}

function renderChoices(choices) {
    const container = document.getElementById('choice-container');
    container.innerHTML = ''; // Clear old buttons
    
    choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'btn'; // Make sure this matches your button style
        btn.textContent = choice.text;
        
        btn.onclick = () => {
            // Save choice if needed (like scene2Choice = choice.choiceId)
            if(choice.choiceId) window[`${currentScene}Choice`] = choice.choiceId;
            
            // Go to next scene
            handleNextScene(choice.next); 
        };
        
        container.appendChild(btn);
    });

    // Automatically scroll to the bottom of the messages so we see the new pinned buttons
    const msgBox = document.getElementById('chat-messages');
    msgBox.scrollTop = msgBox.scrollHeight;
}

        function handleChoice(choice) {
            playSFX('click');
            addMessage('player', choice.text);
            document.getElementById('choice-container').innerHTML = '';

            if (choice.choiceId) {
                if (currentScene === 1) scene2Choice = choice.choiceId;
                if (currentScene === 2) scene3Choice = choice.choiceId;
            }

            if (choice.next === 'horror') {
                setTimeout(() => {
                    playMusic('horror');
                    playSFX('horror');
                    // Remove shake effects before transitioning
                    document.getElementById('game-container').classList.remove('screen-shake-light', 'screen-shake-intense');
                    switchScreen('chat-screen', 'horror-screen');
                    startHorrorScene();
                }, 1000);
            } else {
                setTimeout(() => startChatScenario(choice.next), 1500);
            }
        }

        function increaseGlitch() {
            glitchLevel++;
            if (glitchLevel > 1) {
                playSFX('glitch');
                document.getElementById('glitch-overlay').classList.add('active');
            }
            if (glitchLevel > 2) {
                // Intensify glitch effect
                const overlay = document.getElementById('glitch-overlay');
                overlay.style.opacity = '0.3';
            }
        }

        function startHorrorScene() {
            playMusic('horror');
            const fallingContainer = document.getElementById('falling-messages');
            const messages = ["Don't fight it.", "I can destroy you", "Everyone will see", "Your reputation is mine", "Send more...", "Or else..."];
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const text = document.createElement('div');
                    text.className = 'falling-text';
                    text.textContent = messages[Math.floor(Math.random() * messages.length)];
                    text.style.left = Math.random() * 90 + '%';
                    text.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    text.style.animationDelay = Math.random() * 2 + 's';
                    fallingContainer.appendChild(text);
                }, i * 200);
            }
        }

        const safetyTips = [
            { text: "Think before you post. Once something is online, it can be copied, saved, or shared‚Äîeven if you delete it.", category: "before" },
            { text: "Avoid sharing personal information or images you wouldn't want strangers to have.", category: "when" },
            { text: "Be cautious if someone pressures you to reply quickly or privately.", category: "when" },
            { text: "Question anything that seems unusually flattering, secretive, or too good to be true.", category: "when" },
            { text: "Stop responding and block the person if things start to feel suspicious.", category: "when" },
            { text: "Save messages or screenshots as evidence.", category: "after" },
            { text: "Review your privacy settings regularly. Always be 100% secure of your account.", category: "before" },
            { text: "Reach out to someone you trust for help‚Äîdon't handle it alone.", category: "after" }
        ];

        let draggedItem = null;
        let droppedItems = { before: [], when: [], after: [] };

        function startMinigame() {
    playMusic('horror');
    playSFX('click');
    
    // 1. Start the falling background text immediately
    startHorrorScene(); 
    
    // 2. Prepare the screen
    document.getElementById('game-container').classList.remove('screen-shake-light', 'screen-shake-intense');
    switchScreen('horror-screen', 'minigame-screen');
    
    const content = document.getElementById('minigame-content');
    content.innerHTML = `
        <div class="drag-task">
            <h3>TASK 1: Drag safety tips into correct categories</h3>
            <p>Drag each tip to where it belongs. Think about when each action should be taken!</p>
            <div class="drag-items" id="drag-items"></div>
            <div class="drop-zones">
                <div class="drop-zone" data-category="before" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h4>BEFORE sharing</h4>
                    <div id="zone-before"></div>
                </div>
                <div class="drop-zone" data-category="when" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h4>WHEN chatting</h4>
                    <div id="zone-when"></div>
                </div>
                <div class="drop-zone" data-category="after" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h4>AFTER harmful incident</h4>
                    <div id="zone-after"></div>
                </div>
            </div>
            <button class="btn" onclick="checkTask1()" style="margin-top: 20px; display: none;" id="check-task1">Check Answers</button>
        </div>
    `;

    // 3. Populate drag items
    const dragItems = document.getElementById('drag-items');
    safetyTips.forEach((tip, index) => {
        const item = document.createElement('div');
        item.className = 'drag-item';
        item.draggable = true;
        item.textContent = tip.text;
        item.dataset.category = tip.category;
        item.dataset.index = index;
        item.ondragstart = drag;
        dragItems.appendChild(item);
    });

    // 4. START THE GLITCH AFTER 6 SECONDS
    console.log("Glitch timer started..."); // Check your console (F12) to see if this triggers
    setTimeout(startGlitchLoop, 2000);
}

        function drag(ev) {
            draggedItem = ev.target;
            ev.target.classList.add('dragging');
        }

        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('over');
        }

        function drop(ev) {
            ev.preventDefault();
            playSFX('click');
            ev.currentTarget.classList.remove('over');
            if (draggedItem) {
                const category = ev.currentTarget.dataset.category;
                const zone = document.getElementById(`zone-${category}`);
                const droppedDiv = document.createElement('div');
                droppedDiv.className = 'dropped-item';
                droppedDiv.textContent = draggedItem.textContent;
                droppedDiv.dataset.category = draggedItem.dataset.category;
                zone.appendChild(droppedDiv);
                droppedItems[category].push({ text: draggedItem.textContent, correct: draggedItem.dataset.category });
                draggedItem.remove();
                draggedItem.classList.remove('dragging');
                draggedItem = null;
                if (document.querySelectorAll('.drag-item').length === 0) {
                    document.getElementById('check-task1').style.display = 'block';
                }
            }
        }

        function checkTask1() {
            playSFX('click');
            let correct = 0;
            let total = 0;
            let wrongCategories = [];
            
            Object.keys(droppedItems).forEach(category => {
                droppedItems[category].forEach(item => {
                    total++;
                    if (item.correct === category) {
                        correct++;
                    } else {
                        wrongCategories.push(item.text.substring(0, 30) + '...');
                    }
                });
            });
            
            if (correct === total) {
                playSFX('success');
                // Show Boopy's congratulations
                const boopyMsg = document.createElement('div');
                boopyMsg.style.cssText = 'background: #2d2d2d; padding: 20px; border-radius: 10px; border: 2px solid #0f0; margin: 20px 0; text-align: center;';
              boopyMsg.innerHTML = `
    <div style="font-size: 40px; margin-bottom: 10px;"></div>
    <p style="color: #ffffff; font-weight: bold; margin-bottom: 5px;"></p>
    <p style="color: #ffffff;">"Good job! You got everything right!"</p>
`;
                setTimeout(() => {
                    startTask2();
                }, 2000);
            } else {
                playSFX('wrong');
                alert(`Oops...are you sure that's correct?\n\nYou got ${correct}/${total} in the right categories.\n\nTry again!`);
                
                // Reset the task
                droppedItems = { before: [], when: [], after: [] };
                document.getElementById('zone-before').innerHTML = '';
                document.getElementById('zone-when').innerHTML = '';
                document.getElementById('zone-after').innerHTML = '';
                
                // Re-add all items
                const dragItems = document.getElementById('drag-items');
                dragItems.innerHTML = '';
                safetyTips.forEach((tip, index) => {
                    const item = document.createElement('div');
                    item.className = 'drag-item';
                    item.draggable = true;
                    item.textContent = tip.text;
                    item.dataset.category = tip.category;
                    item.dataset.index = index;
                    item.ondragstart = drag;
                    dragItems.appendChild(item);
                });
                
                document.getElementById('check-task1').style.display = 'none';
                setTimeout(startGlitchLoop, 500);
}
            }
        

      
function startTask2() {
  startHorrorScene();
    // Reset selection counter just in case
    correctSelections = 0;
   
    
    document.getElementById('minigame-progress').textContent = 'Task 2/2';
    const content = document.getElementById('minigame-content');
    const template = document.getElementById('task2-template');
    
    // Clear Task 1 content
    content.textContent = ''; 

    // Clone the container from our HTML template
    const taskUI = template.querySelector('.spot-fake-container').cloneNode(true);

    // Find all screenshots in the cloned UI and attach the logic
    const screens = taskUI.querySelectorAll('.screenshot');
    screens.forEach(screenDiv => {
        // Read if it's fake from the data attribute we set in HTML
        const isFake = screenDiv.getAttribute('data-fake') === 'true';
        
        screenDiv.onclick = function() {
            checkScreenshot(this, isFake);
        };
    });

    content.appendChild(taskWrapperTitle()); // Optional: adds the title back
    content.appendChild(taskUI);
}

// Small helper to add the title back since we cleared content
function taskWrapperTitle() {
    const title = document.createElement('h3');
    title.textContent = 'TASK 2: Spot the AI-generated images!';
    title.style.marginBottom = '15px';
    title.style.color = 'white';
    return title;
}
        let correctSelections = 0;
        const totalFakes = 2;

        function checkScreenshot(element, isCorrect) {
            playSFX('click');
            if (element.classList.contains('correct') || element.classList.contains('wrong')) return;

            if (isCorrect) {
                playSFX('correct');
                element.classList.add('correct');
                correctSelections++;
                if (correctSelections === totalFakes) {
                    setTimeout(() => {
                        playSFX('success');
                        alert('Perfect! You spotted both AI generated images!\n\nSystem is now locking the stranger out...');
                        showRecovery();
                    }, 500);
                }
            } else {
                playSFX('wrong');
                element.classList.add('wrong');
                setTimeout(() => {
                    alert('Take a closer look...\n\nThat screenshot is actually real. Look for signs of AI manipulation in the others.');
                    element.classList.remove('wrong');
                }, 500);
                setTimeout(startGlitchLoop, 500);
}
            }
        
function startGlitchLoop() {
    setInterval(() => {
        const elements = document.querySelectorAll('#minigame-screen button, #minigame-screen h3, #minigame-screen h4, .drag-item, .drop-zone h4, .dropped-item');
        
        // 1. Entire screen flash
        const screen = document.getElementById('minigame-screen');
        screen.style.filter = "invert(1) contrast(200%)";
        setTimeout(() => screen.style.filter = "none", 100);

        // 2. Glitch every element
        elements.forEach(el => {
            applyHorrorGlitch(el);
        });
    }, 3000); // Frequency of the total system glitch
}

function applyHorrorGlitch(el) {
    const originalText = el.textContent;
    const originalStyle = el.style.cssText;

    // Phase 1: Corruption (The "Scary" part)
    el.classList.add('extreme-glitch');
    
    // Randomly turn text into gibberish briefly
    el.style.transform = `scale(${1 + Math.random() * 0.15}) rotate(${Math.random() * 4 - 2}deg) translateX(${Math.random() * 10 - 5}px)`;
    
    // This creates a "sliced" look through the text
    el.style.clipPath = `inset(${Math.random() * 20}% 0 ${Math.random() * 20}% 0)`;

    // 3. Recovery (Half a second later)
    setTimeout(() => {
        el.classList.remove('extreme-glitch');
        el.style.cssText = originalStyle;
        el.style.clipPath = "none";
        el.style.transform = "none";
    }, 500); 
}
        function showRecovery() {
            switchScreen('minigame-screen', 'chat-screen');
            playMusic('calm');
            document.querySelector('.header-profile span').textContent = 'üü¢ SYSTEM RECOVERED';
            document.getElementById('scene-indicator').style.display = 'none';
            
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            const messages = [
                { sender: 'system', text: '‚úì Stranger has been BLOCKED' },
                { sender: 'system', text: '‚úì All malicious content REMOVED' },
                { sender: 'system', text: '‚úì Evidence SAVED for authorities' },
                { sender: 'system', text: 'üéâ Chatroom secured!' }
            ];
            
            let delay = 0;
            messages.forEach(msg => {
                setTimeout(() => addMessage(msg.sender, msg.text), delay);
                delay += 1000;
            });
            
            setTimeout(() => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = 'View Final Message';
                btn.onclick = () => {
                    playSFX('click');
                    switchScreen('chat-screen', 'results-screen');
                };
                document.getElementById('choice-container').appendChild(btn);
            }, delay + 500);
        }

        function restartGame() {
            playSFX('click');
            playMusic('intro');
            currentScene = 0;
            glitchLevel = 0;
            currentQuizIndex = 0;
            scene2Choice = "";
            scene3Choice = "";
            correctSelections = 0;
            droppedItems = { before: [], when: [], after: [] };
            
            // Clean up all effects
            const overlay = document.getElementById('glitch-overlay');
            overlay.classList.remove('active');
            overlay.style.opacity = '0';
            document.getElementById('game-container').classList.remove('screen-shake-light', 'screen-shake-intense');
            document.getElementById('username-input').value = '';
            
            // Reset header
            document.querySelector('.header-profile span').textContent = 'alex.xx';
            document.getElementById('scene-indicator').style.display = 'none';
            
            switchScreen('results-screen', 'intro-screen');
        }

        window.addEventListener('load', () => playMusic('intro'));
        let chatroomStep = 0;

// 1. The Starting Trigger
function startTheChatroom() {
    // 1. Force the screen to be visible and black
    const screen = document.getElementById('the-chatroom-screen');
    screen.style.display = 'block'; 
    
    // 2. Clear old logs so it starts fresh
    const log = document.getElementById('chatroom-log');
    log.innerHTML = ''; 

    // 3. Camera Start
    const video = document.getElementById('webcam-live');
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(s => { video.srcObject = s; })
            .catch(e => console.log("Webcam block: ", e));
    }

    // 4. Trigger Alex after 1 second
    setTimeout(startStrangerConversation, 1000);
}
function startStrangerConversation() {
    addChatroomMsg('system', 'alex.xx has joined The Chatroom');
    
    strangerTyping(() => {
        addChatroomMsg('alex.xx', 'no wayy lol');
        strangerTyping(() => {
            addChatroomMsg('alex.xx', 'I recognise you');
            showChatroomChoices([
                { text: "Hey? Who is this?", next: step1 }
            ]);
        }, 1500);
    }, 2000);
}

function step1() {
    strangerTyping(() => {
        addChatroomMsg('alex.xx', 'I was from your secondary school');
        strangerTyping(() => {
            addChatroomMsg('alex.xx', 'we meet at a bd party long ago');
            showChatroomChoices([
                { text: "Wtf, whose bd party lol", next: step2 }
            ]);
        }, 2000);
    }, 1500);
}

function step2() {
    strangerTyping(() => {
        addChatroomMsg('alex.xx', 'i forgottt');
        strangerTyping(() => {
            addChatroomMsg('alex.xx', 'but i swear i recognise you');
            strangerTyping(() => {
                // This uses the name the player typed at the beginning
                addChatroomMsg('alex.xx', `youre ethan's friend right?`);
                showChatroomChoices([
                    { text: "Omg ya‚Ä¶thats actually crazy", next: step3 }
                ]);
            }, 1500);
        }, 1500);
    }, 2000);
}

function step3() {
    strangerTyping(() => {
        addChatroomMsg('alex.xx', 'we have mutuals on fakestagram i think');
        strangerTyping(() => {
            addChatroomMsg('alex.xx', 'thats crazy lol, what are the chances of meeting u here');
            showChatroomChoices([
                { text: "Wait‚Ä¶turn on your webcam so i can see who you are", next: step4 }
            ]);
        }, 2000);
    }, 1500);
}

function step4() {
    strangerTyping(() => {
        addChatroomMsg('alex.xx', 'suree');
        
        const strangerVid = document.getElementById('stranger-video-male');
        const placeholder = document.getElementById('stranger-video-placeholder');
        
        // 1. Assign the source instantly
        
        // Select the correct video element based on the user's preference
        const selectedVid = (meetPreference === 'male') ? 
                            document.getElementById('vid-male') : 
                            document.getElementById('vid-female');
        // 2. Snap the video on
       strangerVid.style.display = 'block';
        placeholder.style.display = 'none';
        strangerVid.load(); // Reloads the source to ensure it's fresh

        // 2. Play with error handling (Bypasses Autoplay blocks)
        strangerVid.play().then(() => {
            console.log("Video playing successfully");
        }).catch(error => {
            console.error("Autoplay was prevented. Trying again with mute forced...", error);
            strangerVid.muted = true;
            strangerVid.play();
        });
        // 3. The Sudden Snap Off
        setTimeout(() => {
            // Instant termination - no transitions
            strangerVid.pause();
            strangerVid.style.display = 'none';
            // --- UPDATED LINE BELOW ---
            placeholder.style.display = 'flex';
            placeholder.textContent = "CAMERA OFF"; // Changed from SIGNAL LOST
            // --------------------------
            
            strangerTyping(() => {
                addChatroomMsg('alex.xx', 'i feel so shy, idk');
                strangerTyping(() => {
                    addChatroomMsg('alex.xx', 'maybe we can talk on fakstagram instead? To be more casual');
                    // This triggers the sliding notification
                    setTimeout(showFakestagramNotif, 2000);
                }, 2000);
            }, 1500);
        }, 4000);
    }, 1000);
}
function strangerTyping(callback, delay = 2000) {
    const log = document.getElementById('chatroom-log');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'system-msg';
    typingDiv.style.color = '#555';
    typingDiv.style.textAlign = 'left';
    typingDiv.id = 'active-typing';
    typingDiv.textContent = 'alex.xx is typing...';
    log.appendChild(typingDiv);
    log.scrollTop = log.scrollHeight;

    setTimeout(() => {
        const el = document.getElementById('active-typing');
        if (el) el.remove();
        callback();
    }, delay);
}

function addChatroomMsg(sender, text) {
    const log = document.getElementById('chatroom-log');
    const div = document.createElement('div');
    div.style.marginBottom = '12px';
    
    if (sender === 'system') {
        div.style.textAlign = 'center';
        div.style.color = '#888';
        div.style.fontSize = '12px';
        div.textContent = text;
    } else {
        const nameColor = (sender === 'alex.xx') ? '#ff4d4d' : '#00ff00';
        div.innerHTML = `<strong style="color: ${nameColor}">${sender}:</strong> <span style="color: white">${text}</span>`;
    }
    
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
    if (text === "maybe we can talk on fakstagram instead? To be more casual") {
        console.log("Trigger phrase detected! Showing notification in 2 seconds...");
        
        // Wait 2 seconds so the player can read the message first
        setTimeout(() => {
            showFakestagramNotif();
        }, 2000);
    }
}

function showChatroomChoices(choices) {
    const container = document.getElementById('chatroom-choices');
    const controls = document.getElementById('chatroom-controls');
    const log = document.getElementById('chatroom-log');
    
    container.innerHTML = '';
    
    // 1. Force display and high z-index
    controls.style.display = 'flex';
    controls.style.zIndex = '99999';
    
    choices.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = c.text;
        
        // Inline styles to ensure they are visible and "on top"
        btn.style.pointerEvents = 'auto';
        btn.style.cursor = 'pointer';
        btn.style.position = 'relative';
        btn.style.zIndex = '100000';

        btn.onclick = (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log("Choice clicked: " + c.text);
            controls.style.display = 'none';
            addChatroomMsg(playerUsername, c.text);
            c.next();
        };
        container.appendChild(btn);
    });

    // 2. THE FIX: Force the browser to re-draw the layout
    // This is the code version of "Right-Click -> Inspect"
    window.dispatchEvent(new Event('resize'));
    
    // 3. Auto-scroll to ensure user sees the prompt
    setTimeout(() => {
        log.scrollTop = log.scrollHeight;
    }, 100);
}
function showFakestagramNotif() {
    console.log("Notification function triggered!");
    let notif = document.getElementById('fakestagram-notification');
    if (!notif) {
        notif = document.createElement('div');
        notif.id = 'fakestagram-notification';
        notif.className = 'notification-popup';
        notif.innerHTML = `
            <div class="notif-icon" style="background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888); color:white; padding:10px; border-radius:10px; font-family:sans-serif;">F</div>
            <div class="notif-content">
                <div style="font-weight:bold; font-size:14px; color:black;">Fakestagram</div>
                <div style="font-size:13px; color:#444;"><strong>alex.xx</strong>: Found ya lol lol</div>
            </div>
        `;
        document.body.appendChild(notif);
    }

    notif.onclick = function() {
        console.log("Notification clicked!");
        notif.classList.remove('show');
        
        if (typeof switchScreen === 'function') {
            switchScreen('the-chatroom-screen', 'chat-screen');
        } 

        const target = document.getElementById('chat-screen');
        const current = document.getElementById('the-chatroom-screen');
        
        if (target && current) {
            current.style.display = 'none';
            current.classList.remove('active');
            target.style.display = 'block';
            target.classList.add('active');
            console.log("Manual switch successful");
        }

        if (typeof startChatScenario === 'function') {
            startChatScenario('scene1');
        }
    };

    // THIS PART MAKES IT SLIDE IN
    setTimeout(() => {
        notif.classList.add('show');
        console.log("Notification is now visible.");
    }, 100);
} // <--- THIS WAS THE MISSING BRACKET
    </script>
   <template id="boopy-template-hero">
    <div class="boopy-intro-hero">
        <img src="boopy hi.png" alt="Boopy">
        <div class="hero-text">
            <h2>Hi! I'm Boopy!</h2>
            <p>Let's learn how to stay safe online.</p>
        </div>
        <hr class="hero-divider">
    </div>
</template>

<template id="boopy-template-1">
    <div class="boopy-edu-standalone">
        <img src="boopy-learn.png" alt="Boopy">
        <span style="display:none; font-size: 60px;">ü§ñ</span>
    </div>
</template>

<template id="boopy-template-2">
    <div class="boopy-edu-standalone">
        <img src="boopy-teachh.png" alt="Boopy">
        <span style="display:none; font-size: 60px;">ü§ñ</span>
    </div>
</template>
<template id="boopy-template-correct">
    <div class="boopy-quiz-feedback">
        <img src="boopy-correct.png" alt="Correct!">
    </div>
</template>

<template id="boopy-template-wrong">
    <div class="boopy-quiz-feedback">
        <img src="boopy-wrong.png" alt="Wrong">
    </div>
</template>

<template id="voice-msg-template">
    <div class="voice-message-bubble">
        <div class="play-button">
            <span class="play-icon">‚ñ∂</span>
        </div>
        <div class="voice-wave-container">
            <div class="voice-wave-bar"></div>
            <div class="voice-wave-bar"></div>
            <div class="voice-wave-bar"></div>
            <div class="voice-wave-bar"></div>
        </div>
        <span class="voice-duration">0:04</span>
    </div>
</template>

</body>
</html>
